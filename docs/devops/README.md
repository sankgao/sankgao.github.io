---
title: DevOps
icon: devops
date: 2023-08-08
category: DevOps
tag:
    - DevOps
---

记录一些 DevOps 相关的信息。

<!-- more -->

## DevOps

DevOps 将开发（`Development`）和运维（`Operations`）结合起来，与传统流程相比，提高软件开发和交付的效率、速度和安全性。它旨在缩短系统开发生命周期并提供高质量软件的持续交付。DevOps 与敏捷软件开发是互补的；DevOps 的几个方面都来自敏捷方法论。

DevOps 为人们共同努力以最快的速度构思、构建和交付安全的软件。DevOps 实践使软件开发和运维团队能够通过自动化、协作、快速反馈和迭代改进来加速交付。DevOps 流程源于软件开发的敏捷方法，扩展了构建的跨职能方法并以更快、更迭代的方式交付应用程序。

在采用 DevOps 开发流程时，您决定通过在开发周期的各个阶段鼓励更具协作性的环境来改善应用程序的流程和价值交付。DevOps 代表了 IT 文化思维方式的变化。在敏捷、精益实践和系统理论的基础上，DevOps 专注于增量开发和软件的快速交付。成功依赖于创建问责文化、改善协作、同理心以及对业务成果共同负责的能力。

### DevOps 核心原则

- **软件开发生命周期的自动化**：这包括自动化测试、构建、发布、开发环境的配置以及其他可能会减慢软件交付过程或在软件交付过程中引入人为错误的手动任务
- **协作与沟通**：一个好的 DevOps 团队具有自动化，但一个优秀的 DevOps 团队还具有有效的协作和沟通
- **持续改进并最大限度地减少浪费**：从自动化重复性任务到观察性能指标以寻找减少发布时间或平均恢复时间的方法，高绩效的 DevOps 团队会定期寻找可以改进的领域
- **高度关注用户需求，反馈周期短**：通过自动化、改进的沟通和协作以及持续改进，DevOps 团队可以花一些时间专注于真正的用户真正想要什么，以及如何将其提供给他们

通过采用这些原则，组织可以提高代码质量、缩短上市时间并进行更好的应用程序规划。

### DevOps 的四个阶段

DevOps 的发展经历了四个不同的阶段，每个阶段都以技术和组织实践的转变为标志。这一进展反映了 DevOps 中日益增长的复杂性，主要由两个关键趋势驱动：

- **向微服务过渡**：随着组织从整体架构转向更灵活的微服务架构，对专业 DevOps 工具的需求激增。这一转变旨在适应微服务提供的更高的粒度和敏捷性
- **工具集成的增加**：项目的激增以及对更多 DevOps 工具的相应需求导致项目和工具之间的集成数量显着增加。这种复杂性促使组织重新考虑采用和集成 DevOps 工具的方法

DevOps 的发展经历了四个不同的阶段，每个阶段都解决软件开发和交付不断增长的需求和复杂性。这四个阶段如下：

- 第一阶段：自带 DevOps（BYOD）

    在 “自带 DevOps” 阶段，每个团队选择了自己的工具。当团队由于不熟悉其他团队的工具而试图一起工作时，这种方法会引起问题。此阶段强调需要更统一的工具集，以促进更顺畅的团队集成和项目管理。

- 第二阶段：一流的 DevOps

    为了解决使用不同工具的挑战，组织进入了第二阶段，即一流的 DevOps。在此阶段，组织对同一组工具进行标准化，并为 DevOps 生命周期的每个阶段提供一个首选工具。它帮助团队相互协作，但问题就变成了通过每个阶段的工具来移动软件更改。

- 第三阶段：自己动手（DIY）DevOps

    为了解决这个问题，组织采用了自己动手（DIY）DevOps，在其工具之上和工具之间进行构建。他们执行了大量自定义工作，将 DevOps 单点解决方案集成在一起。然而，由于这些工具是独立开发的，没有考虑集成，因此它们永远不会完全合适。对于许多组织来说，维护 DIY DevOps 是一项巨大的工作，并且会导致更高的成本，因为工程师需要维护工具集成而不是开发其核心软件产品。

- 第四阶段：DevOps 平台

    单一应用程序平台方法可提高团队体验和业务效率。DevOps 平台取代了 DIY DevOps，允许整个 DevOps 生命周期的所有阶段的可见性和控制。

    通过使所有团队（开发、运营、IT、安全和业务）能够在端到端统一系统中协作规划、构建、保护和部署软件，DevOps 平台代表了实现全面交付的根本性变革。

### DevOps 文化的好处

DevOps 的商业价值和 DevOps 文化的好处在于能够改善生产环境，以便通过持续改进更快地交付软件。您需要能够立即预测并响应行业颠覆者。这在敏捷软件开发过程中成为可能，团队被授权自主并更快地交付，从而减少正在进行的工作。一旦发生这种情况，团队就能够以市场的速度响应需求。

为了使 DevOps 按设计发挥作用，需要将一些基本概念付诸实践，包括需要：

消除导致障碍和限制的制度化孤岛和交接，特别是在一个团队的成功衡量标准与另一个团队的关键绩效指标 (KPI) 直接不一致的情况下。

使用单个应用程序实施统一的工具链，允许多个团队共享和协作。这将使团队能够加快交付速度并相互提供快速反馈。

### DevOps 生命周期以及 DevOps 的工作原理

DevOps生命周期从软件开发开始一直延伸到交付、维护和安全。 DevOps 生命周期的阶段包括：

计划：组织需要完成的工作，确定其优先顺序，并跟踪其完成情况。

创建：与您的团队一起编写、设计、开发和安全地管理代码和项目数据。

验证：确保您的代码正常工作并符合您的质量标准 - 最好通过自动化测试。

打包：打包应用程序和依赖项、管理容器并构建工件。

安全：通过静态和动态测试、模糊测试和依赖关系扫描来检查漏洞。

发布：将软件部署给最终用户。

配置：管理和配置支持您的应用程序所需的基础设施。

监控：跟踪性能指标和错误，以帮助降低事件的严重性和频率。

治理：管理整个组织的安全漏洞、策略和合规性。

### DevOps 工具、概念和基础知识

DevOps 涵盖了整个应用程序生命周期的广泛实践。在 DevOps 成功之旅中，团队通常会从这些实践中的一项或多项开始。

|  话题  |  描述  |
|  :----  |  :----  |
|  版本控制  |  跟踪和管理对源代码和其他文件所做的每个更改的基本实践。版本控制与源代码管理密切相关  |
|  敏捷  |  敏捷开发意味着采用迭代、增量和精益的方法来简化和加速项目的交付  |
|  持续集成（CI）  |  定期将所有代码更改集成到主分支、自动测试每个更改并自动启动构建的做法  |
|  持续交付（CD）  |  持续交付与持续集成相结合，实现基础设施配置和应用程序发布流程的自动化。它们通常统称为CI/CD  |
|  左移  |  一个术语，用于在开发过程中更早地转移安全性和测试。这样做可以帮助加快开发速度，同时提高代码质量  |

### DevOps 最佳实践

DevOps的实施需要遵循一些最佳实践：

- 建立跨功能团队：组织应建立一个包括开发人员、运维人员、测试人员和业务分析师在内的跨功能团队。
- 引入自动化：自动化是DevOps的核心，它可以减少手动错误，提高效率和一致性。
- 实现微服务架构：微服务架构可以帮助组织更快地开发和部署应用程序，而不会影响整个系统。
- 采用IaC：通过代码管理基础设施，组织可以确保环境的一致性，降低配置错误。

## DevSecOps

传统上，安全性是在开发生命周期的最后阶段出现的，当代码不可避免地被发送回开发人员进行修复时，会增加成本和时间。DevSecOps 是开发、安全和运维的组合。它是一种在整个开发生命周期中集成安全性的软件开发方法。

DevSecOps 是 DevOps 的演变。DevSecOps 包括软件开发每个阶段的应用程序安全实践。

在整个开发过程中，工具和方法会保护和监控您的实时应用程序。新的攻击面，如：容器和编排器，也必须受到监控和保护。DevSecOps 工具可自动化安全工作流程，为您的开发和安全团队创建适应性强的流程，从而改善协作并打破孤岛。通过将安全性嵌入到软件开发生命周期中，您可以始终如一地保护快速移动和迭代的流程，从而在不牺牲质量的情况下提高效率。

## GitOps

GitOps 是一个运维框架，它吸纳了用于应用程序开发的 DevOps 最佳实践，例如：版本控制、协作、合规、和 CI/CD 等，并将它们用于基础架构自动化。

### 极狐 GitLab 优势

- **适用 SCM 和 CI/CD 的单一应用程序**：源代码管理和 CI/CD 是 GitOps 的核心能力
- **与 Terraform 紧密集成**：Terraform 已经成为准备环境的行业标杆。GitLab 是 HashiCorp 的合作伙伴，可以确保您的工具能够以最佳状态协同工作
- **倍受全球最大工程师群体信赖**：诸多国际大型企业选择 GitLab 作为代码托管和开放运维平台。极狐 GitLab 是 GitLab 的中国发行版，基于 GitLab EE 每月同步更新，并增加针对国内用户需求的增值特性

### 极狐 GitLab 能力

- **基于 Git 的版本控制**：使用现有的 Git 工具作为操作界面。将您的基础架构作为代码（Infrastructure as Code）与配置、策略一起版本化，创造可重现的场景。当事件发生时，恢复到上一个已知的工作状态，从而缩短平均解决时间（MTTR）
- **代码审查**：在 Merge Request 启动前改善代码质量、分发最佳实践，捕捉错误，持续跟踪和解析多线程，采纳内联建议，并与内联和常规线程异步工作
- **受保护的分支**：在允许所有人在共享代码存储库中作出贡献的同时，在受保护分支中设置唯一授权以限制部署生产所有权
- **CI/CD**：GitLab 被持续评为 CI/CD 领域领导者，极狐 GitLab 提供强大的、可扩展的 CI/CD，从底层构建到与您的敏捷规划和源代码管理相同的应用程序，获得无缝体验
- **Terraform 集成**：极狐 GitLab 保存您的 Terraform 状态文件，并直接在合并请求中显示 Terraform 计划产出
- **任意部署方式**：从容器、虚拟机到裸机，极狐 GitLab 支持多种部署方式，也支持多云服务

## CI/CD

CI/CD 是落地实践 DevOps 的关键手段，它能够实现源码从构建、测试到部署上线的全流程自动化，极大地提高企业软件的发布速度与发布频率。让企业软件的按时、按需交付成为可能，助力企业向精英效能的转型。

CI：用户输入了分支之后，然后流水线下载代码，然后去构建生成包，之后扫描生成了报告。然后将这个包传到了制品仓库里面，这就是 CI 要做的一些事情。

CD：传到仓库之后又会有一条 CD 的流水线，也是需要用户手动去触发的，拿到版本号去下载哪个包，将包下载下来，通过 ansible 或者 slatstack 发布到主机，然后通过脚本启动起来，然后做一些健康检查，甚至还有一些回滚的操作。

CI 作业：用户输入版本分支后下载代码，进行构建扫描最终将制品上传到制品仓库, 生成版本文件。
CD 作业: 用户输入发布版本和选择要发布的主机 IP 后，下载制品，将制品和服务启动脚本 cp 到目标机器的发布目录，远程执行启动脚本启动服务并进行健康检查。

### 持续集成

持续集成，也就是通常所说的 CI（Continuous Integration），可以说是现代软件开发技术的基础。从简单的、有计划的、自动化的构建逐渐改进为可以持续交付投入生产中。一个好的持续集成基础设施可以简化开发过程直到部署，可以帮助开发人员更快地检测和修复 bug，为所有开发和非开发人员提供一个有用的项目仪表盘，最后帮助团队交付更真实的业务价值给最终用户。

在集成阶段，某些开发人员或者小团队做出的代码改动，都会零零散散地整合进最终产品，有时甚至仅集成一些冲突性的变更都会消耗数月之久的时间。而且不仅很难去预期会突然出现什么类型的问题，更难的是去修复它们，因为它可能会使您不得不去重写之前已经写了几周或者几个月的代码。这个过程不仅痛苦，而且充满了风险和危险，且往往会导致延迟重要交付、额外开销的后果，最终引来客户的不满。持续集成的出现就是为了定位和解决这些问题。

持续集成，就其最简单的形式来讲，就是一个能监控您版本控制系统变化的工具。无论任何时候，只要检测到有变化，这个工具就会自动编译和测试您的应用程序。如果出现问题，它就马上通知开发人员，以便他们可以立即着手解决这个问题。

持续集成还能帮您密切监视代码库的健康，自动监控代码质量和代码覆盖率度量，还能帮助您降低技术债务和减少维护成本。结合自动化的端到端的验收测试，持续集成也可以作为一种沟通工具，清晰地发布和展现总体开发工作的当前状态。通过构建自动化部署过程，持续集成能大大简化和加速您的交付过程，自动化和一键部署应用程序的最新版本。

### 持续部署

从本质上讲，持续集成是通过提供更快的反馈来降低风险的。通过更好地为技术和非技术团队成员提供项目状态的可视化，持续集成打开并改善了团队成员间的沟通渠道，同时鼓励他们协作解决问题和过程改进。通过把部署过程自动化，持续集成可以帮助您更快、更可靠、更轻松地把软件交付到测试人员和最终用户的手上。这种直接自动化部署每个成功的构建到生产当中的实践，就是所谓的持续部署。

单一的持续部署方式并不总是适合每个人。比如，很多用户并不喜欢一周内接二连三地部署新的版本，他们更喜欢一个可预见的（透明的）发布周期。除此之外，在真正部署一个新版本的时候，商业和市场营销也是需要考虑的重要方面。

### 持续交付

使用持续交付，任何通过了相关自动化测试和质量关的构建，都能通过完全自动化且一键部署的方式被部署到生产中，并且在几分钟内交付给最终用户。

当然，这整个过程并不是自动进行的，它是业务，而不是信息技术，需要决定一个最佳时机来交付最新的变化。

> 因此，持续集成技术，特别是持续部署和持续交付，就是为了更快地给最终用户提供价值。您的团队从一个小的代码改动到投入生产需要多长时间？这个过程会涉及多少可以提早修复的问题？您了解任何一个团队成员做出的代码修改吗？会让劳动密集型手工测试的 QA 团队花费多少时间？会涉及多少手动部署的步骤？大概只有少数人能真正了解上述全部问题。持续集成不是无所不能的，不过它确实能帮助您简化许多这样的问题。
> 
> 持续集成可以说是一种思维工具集。想要充分地利用好持续集成，您的团队必须要先进入持续集成的思维方式中。例如：您的项目必须有一个可靠的、可重复的、自动化的构建过程，并且不涉及人工干预。能保证优先修复有问题的构建，而不是停滞不前、不管不理。这个部署过程应该是自动化的，不应该有任何的人工干预。由于持续集成服务器可信度的好坏在很大程度上取决于您测试的质量，所以团队需要设计强健的、高质量的测试和测试实践。

### 引进持续集成到您的公司

持续集成并不是一个一蹴而就的事物。把持续集成引进到一个公司需要通过几个不同的发展阶段。

- 阶段 1 —— 无构建服务器

    最初，团队没有任何形式的中央构建服务器。软件是在开发人员的机器上手工触发构建的，尽管这个构建可能使用了 Ant 脚本或者其他类似的东西。源代码可能存储在一个中央源代码仓库中，但开发人员却不需要定期提交其代码变更。在计划发布一个新版本之前的那段时间里，开发人员需要手动集成他的代码改动，这个过程是非常痛苦的。

- 阶段 2 —— 夜间构建

    在这个阶段，团队有一个构建服务器，并且会按计划定期（通常是夜间）触发自动化构建过程。这种构建只是简单的代码编译，没有可靠的或可重复的单元测试。事实上，如果写了自动化测试的话，它也不是强制性地要作为构建过程的一部分，并很可能运行的不正确。在这个阶段，开发人员至少会在每天结束之前定期提交他们的更改。假如开发人员提交的代码改动与另外一个开发人员的代码改动发生冲突，构建服务器会在第二天早上通过发送邮件的形式向团队报警。不过，在这个阶段，团队仍然倾向于只使用构建服务器的消息通知机制——他们不觉得有义务去立即修复一个构建服务器出现的问题，所以有些构建可能一直坏在构建服务器上没人处理。

- 阶段 3 —— 夜间构建加自动化测试

    在这个阶段，团队开始更认真地对待持续集成和自动化测试了。无论任何时候，只要有代码更新提交到版本控制系统中，构建服务器就会触发一个构建，团队成员可以轻易地看到是哪些源代码变化触发了这个特定的构建，以及这些变化是想要处理哪些问题的。此外，构建运行脚本去编译应用程序并且运行一系列的自动化单元和集成测试。除了发送邮件以外，构建服务器也会使用更积极主动的渠道（比如：即时通信）来提醒团队成员在集成的过程中出现了哪些问题。运行失败的构建在这个阶段一般都可以很快地得到修复。

- 阶段 4 —— 加入度量指标

    在这个阶段，构建中会运行自动化的代码质量和代码覆盖率检查，来帮助评估代码库的质量和（至少在一定程度上）测试的相关性以及有效性。检查代码质量的构建也会自动为应用程序生成 API 文档。所有这些都会帮助团队保持一个高质量的代码库，也会对测试质量的下降提出警报。团队一般还会建立 “构建展示器”，它是一个项目状态的仪表盘视图，可以放在屏幕的一个突出位置上让所有团队成员看到。

- 阶段 5 —— 更认真地对待测试

    持续集成的好处是可以和可靠的测试实践紧密结合。现在，驱动测试开发模式被广泛应用，以至于自动化构建的结果越来越值得信赖。应用程序不再只是简单地被编译和测试，如果测试通过了的话，它会被自动部署到一个应用服务器上来进行更全面的端到端测试和性能测试。

- 阶段 6 一 自动化验收测试和自动化部署

    这个阶段的开发工作是由验收测试驱动的，能更好地指导开发工作和提供高水准的项目状态报告。这些自动化测试采用行为驱动开发和验收测试驱动开发工具作为交流和文档工具以及文档测试工具，最后用非开发人员都可以理解的业务术语来发布测试结果报告。在整个开发过程的早期阶段就使用了这些高级的自动化测试，它们清晰地展示出哪些功能特性已经完成了，哪些还有待完成。不管是有改动提交，还是定期在夜间触发构建，应用程序都会被自动部署到测试环境当中以便 QA 团队进行测试。当测试人员认为可以的时候，就可以手动触发构建来部署一个新的版本去进行用户验收测试或者直接交付到生产环境。如果当前版本中出现了严重的问题，团队还可以使用构建服务器把当前版本回滚到上一个版本。

- 阶段 7 —— 持续部署

    在这个阶段，团队对于自动化的单元、集成和验收测试已经非常有信心了，在上个阶段开发的自动化部署技术现在可以用来将一些新的变化直接推送到生产中去。上述可能与现实情况并不匹配。比如：在集成了代码质量和代码覆盖率报告之前，您可能已经很了解自动化 Web 测试。然而，应该给出一个常用的思路，就是怎么做才能在现实世界里的公司中实现持续集成策略。

<AutoCatalog level="2"/>
