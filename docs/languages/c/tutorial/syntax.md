---
title: 基本语法
icon: syntax
date: 2024-02-23
category: Languages
tag:
    - C
---

C 程序示例文件：

```c
#include <stdio.h>
int main(void)  /* 一个简单的 C 程序 */
{
    int num;  /* 定义一个名为 num 的变量 */
    num = 1;  /* 为 num 赋一个值 */

    printf("I am a simple ");  /* 使用 printf() 函数 */
    printf("computer.\n");
    printf("My favorite number is %d because it is first.\n", num);

    return 0;
}
```

## 标准库，头文件

程序需要用到的功能，不一定需要自己编写，C 语言可能已经自带了。程序员只要去调用这些自带的功能，就省得自己编写代码了。

C 语言自带的所有这些功能，统称为 **标准库**（`standard library`），因为它们是写入标准的，到底包括哪些功能，应该怎么使用的，都是规定好的，这样才能保证代码的规范和可移植。

不同的功能定义在不同的文件里面，这些文件统称为 **头文件**（`header file`）。如果系统自带某一个功能，就一定还会自带描述这个功能的头文件，比如：`printf()` 的头文件就是系统自带的 `stdio.h`。头文件的后缀通常是 `.h`。

如果要使用某个功能，就必须先加载对应的头文件，加载使用的是 `#include` 命令。加载头文件的 `#include` 语句不需要分号结尾。例如：

```c
#include <stdio.h>
```

`#include <stdio.h>` 的作用相当于把 `stdio.h` 文件中的所有内容都输入该行所在的位置。实际上，这是一种 “拷贝-粘贴” 的操作。

`#include` 这行代码是一条 C **预处理器指令**（`preprocessor directive`）。通常，C 编译器在编译前会对源代码做一些准备工作，即 **预处理**（`preprocessing`）。

`stdio.h` 文件中包含了供编译器使用的输入和输出函数（如：`printf()`）信息。该文件名的含义是 **标准输入/输出头文件**。通常，在 C 程序顶部的信息集合被称为 **头文件。**

## 函数

```c
int main(void)
```

C 程序一定从 `main()` 函数开始执行（目前不必考虑例外的情况）。除了 `main()` 函数，你可以任意命名其他函数，而且 `main()` 函数必须是开始的函数。圆括号用于识别 `main()` 是一个函数。

`int` 是 `main()` 函数的返回类型。这表明 `main()` 函数返回的值是整数，并返回给操作系统。

通常，函数名后面的圆括号中包含一些传入函数的信息。该例中没有传递任何信息。因此，圆括号内是单词 `void`。

## 注释

注释是对代码的说明，编译器会忽略注释。

注释有两种表示方法：

- `/* 注释内容 */`

    将注释内容放在 `/*  */` 之间，内部可以分行。这种注释可以插在行内，跟在它后面的代码依然会有效执行。例如：

    ```c
    /* 注释内容 */

    /* 一行注释内容
        另一行注释内容
    */

    int i; /* i = 1; */ i = 2;
    ```

- `// 注释内容`

    将注释内容放在 `//` 之后，这种注释只能是单行，可以放在行首，也可以放在一行语句的结尾。例如：

    ```c
    // 注释内容
    int i;  // 注释内容
    ```

## 语句块

使用一对大括号 `{}` 将多个语句组成一个块，也称为复合语句（`compounded statement`）。大括号的结尾不需要添加分号。例如：

```c
{
    int num;  /* 定义一个名为 num 的变量 */
    num = 1;  /* 为 num 赋一个值 */
    // ...省略部分内容
}
```

## 声明

```bash
int num;
```

这行代码叫作 **声明**（`declaration`）。声明是 C 语言最重要的特性之一，如果事先未声明变量，C 程序将无法通过编译。

在该例中，声明完成了两件事。其一，在函数中有一个名为 `num` 的 **变量**（`variable`）。其二，`int` 表明 `num` 是一个整数（即，没有小数点或小数部分的数）。`int` 是一种 **数据类型**。编译器使用这些信息为 `num` 变量在内存中分配存储空间。**分号** 在 C 语言中是大部分语句和声明的一部分，不像在 `Pascal` 中只是语句间的分隔符。

`int` 是 C 语言的一个 **关键字**（`keyword`），表示一种基本的 C 语言数据类型。关键字是语言定义的单词，不能做其他用途。例如：不能用 `int` 作为函数名和变量名。这些关键字在该语言以外不起作用。

`num` 是一个 **标识符**（`identifier`），也就是一个变量、函数或其他实体的名称。因此，声明把特定标识符与计算机内存中的特定位置联系起来，同时也确定了存储在某位置的信息类型或数据类型。

在 C 语言中，所有变量都必须先声明才能使用。这意味着必须列出程序中用到的所有变量名及其类型。

- **数据类型**：C 语言可以处理多种类型的数据，如：整数、字符和浮点数。把变量声明为整型或字符类型，计算机才能正确地存储、读取和解释数据
- **命名**：给变量命名时要使用有意义的变量名或标识符（如：程序中需要一个变量数羊，该变量名应该是 `sheep_count` 而不是 `x3`）。如果变量名无法清楚地表达自身的用途，可在注释中进一步说明。这种方法让程序的可读性更高。

## 赋值

```bash
num = 1;
```

这行代码是 **赋值表达式语句**。赋值是 C 语言的基本操作之一。该行代码的意思是 “把值 `1` 赋给变量 `num`”。在执行 `int num;` 声明时，编译器在计算机内存中为变量 `num` 预留了空间，然后在执行这行赋值表达式语句时，把值存储在之前预留的位置。可以给 `num` 赋不同的值，这就是 `num` 之所以被称为变量（`variable`）的原因。**注意**：该赋值表达式语句从右侧把值赋到左侧。

C 语言是通过赋值运算符而不是赋值语句完成赋值操作。根据 C 标准，C 语言并没有所谓的 “赋值语句”。

## printf()

```c
printf("I am a simple ");
printf("computer.\n");
printf("My favorite number is %d because it is first.\n",num);
```

第 `1` 行把 `I am a simple` 传递给 `printf()` 函数。该信息被称为 **参数**，或者更确切地说，是函数的 **实际参数**（`actual argument`）。在 C 语言中，实际参数（简称 **实参**）是传递给函数的特定值，形式参数（简称 **形参**）是函数中用于存储值的变量。

第 `1` 行 `printf()` 演示了在 C 语言中如何 **调用** 函数。只需输入函数名，把所需的参数填入圆括号即可。当程序运行到这一行时，控制权被转给已命名的函数（该例中是 `printf()`）。函数执行结束后，控制权被返回至 **主调函数**（`calling function`），该例中是 `main()`。

### 基本用法

`printf()` 的作用是将参数文本输出到屏幕。`f` 代表 `format`（格式化），表示可以定制输出文本的格式。

`printf()` 不会在行尾自动添加 **换行符**，运行结束后，光标就停留在输出结束的地方，不会自动换行。为了让光标移到下一行的开头，可以在输出文本的结尾，添加一个换行符 `\n`。换行符是一个 **转义序列**（`escape sequence`）。转义序列用于代表难以表示或无法输入的字符。如：`\t` 代表 `Tab` 键，`\b` 代表 `Backspace` 键（退格键）。每个转义序列都以 **反斜杠字符**（`\`）开始。

`printf()` 是在标准库的头文件 `stdio.h` 定义的。使用这个函数之前，必须在源码文件头部引入这个头文件。

### 占位符

`printf()` 可以在输出文本中指定 **占位符**。所谓占位符就是这个位置可以用其他值代入。例如：

```c
int num;
num = 1;

printf("My favorite number is %d because it is first.\n", num);
```

`%d` 就是占位符，表示这个位置要用其他值来替换。占位符的第一个字符一律为 **百分号**（`%`），第二个字符表示占位符的 **类型。**

常用的占位符如下：

- **%a**：十六进制浮点数，字母输出为小写
- **%A**：十六进制浮点数，字母输出为大写
- **%c**：字符
- **%d**：十进制整数
- **%e**：使用科学计数法的浮点数，指数部分的 e 为小写
- **%E**：使用科学计数法的浮点数，指数部分的 E 为大写
- **%i**：整数，基本等同于 `%d`
- **%f**：小数（包含 float 类型和 double 类型）
- **%g**：6 个有效数字的浮点数。整数部分一旦超过 6 位，就会自动转为科学计数法，指数部分的 e 为小写
- **%G**：等同于 `%g`，唯一的区别是指数部分的 E 为大写
- **%hd**：十进制 short int 类型
- **%ho**：八进制 short int 类型
- **%hx**：十六进制 short int 类型
- **%hu**：unsigned short int 类型
- **%ld**：十进制 long int 类型
- **%lo**：八进制 long int 类型
- **%lx**：十六进制 long int 类型
- **%lu**：unsigned long int 类型
- **%lld**：十进制 long long int 类型
- **%llo**：八进制 long long int 类型
- **%llx**：十六进制 long long int 类型
- **%llu**：unsigned long long int 类型
- **%Le**：科学计数法表示的 long double 类型浮点数
- **%Lf**：long double 类型浮点数
- **%n**：已输出的字符串数量。该占位符本身不输出，只将值存储在指定变量之中
- **%o**：八进制整数
- **%p**：指针
- **%s**：字符串
- **%u**：无符号整数（unsigned int）
- **%x**：十六进制整数
- **%X**：等同于 `%x`，唯一的区别是指数部分的 X 为大写
- **%zd**：size_t 类型
- **%%**：输出一个百分号

### 输出格式

`printf()` 可以定制占位符的输出格式。

- **限定宽度**

    `printf()` 允许限定占位符的最小宽度。例如：

    ```c
    printf("%5d\n", 123);  // 输出为 "  123"
    ```

    `%5d` 表示这个占位符的宽度至少为 5 位。如果不满 5 位，对应的值的前面会添加空格。

    输出的值默认是右对齐，即输出内容前面会有空格；如果希望改成左对齐，在输出内容后面添加空格，可以在占位符的 `%` 的后面插入一个 `-` 号。例如：

    ```c
    printf("%-5d\n", 123);  // 输出为 "123  "
    ```

    对于小数，这个限定符会限制所有数字的最小显示宽度。例如：

    ```c
    printf("%12f\n", 123.45);  // 输出为 "  123.450000"
    ```

    `%12f` 表示输出的浮点数最少要占据 12 位。由于小数的默认显示精度是小数点后 6 位，所以 123.45 输出结果的头部会添加 2 个空格。

- **总是显示正负号**

    默认情况下，`printf()` 不对正数显示 `+` 号，只对负数显示 `-` 号。如果想让正数也输出 `+` 号，可以在占位符的 `%` 后面加一个 `+`。例如：

    ```c
    printf("%+d\n", 12);  // 输出 +12
    printf("%+d\n", -12);  // 输出 -12
    ```

    `%+d` 可以确保输出的数值，总是带有正负号。

- **限定小数位数**

    输出小数时，有时希望限定小数的位数。比如：希望小数点后面只保留两位。占位符可以写成 `%.2f`。例如：

    ```c
    printf("Number is %.2f\n", 0.5);  // 输出 Number is 0.50
    ```

    这种写法可以与限定宽度占位符，结合使用。例如：

    ```c
    printf("%6.2f\n", 0.5);  // 输出为 "  0.50"
    ```

    `%6.2f` 表示输出字符串最小宽度为 6，小数位数为 2。所以，输出字符串的头部有两个空格。

    最小宽度和小数位数这两个限定值，都可以用 `*` 代替，通过 `printf()` 的参数传入。例如：

    ```c
    printf("%*.*f\n", 6, 2, 0.5);
    // 等同于
    printf("%6.2f\n", 0.5);
    ```

    `%*.*f` 的两个星号通过 `printf()` 的两个参数 6 和 2 传入。

- **输出部分字符串**

    `%s` 占位符用来输出字符串，默认是全部输出。如果只想输出开头的部分，可以用 `%.[m]s` 指定输出的长度，其中 `[m]` 代表一个数字，表示所要输出的长度。例如：

    ```c
    printf("%.5s\n", "hello world");  // 输出 hello
    ```

    `%.5s` 表示只输出字符串 “hello world” 的前 5 个字符，即 “hello”。

## return

```bash
return 0;
```

`int main(void)` 中的 `int` 表明 `main()` 函数应返回一个整数。C 标准要求 `main()` 这样做。有返回值的 C 函数要有 `return` 语句。该语句以 `return` 关键字开始，后面是待返回的值，并以分号结尾。

如果遗漏 `main()` 函数中的 `return` 语句，程序在运行至最外面的右花括号（`}`）时会返回 `0`。因此，可以省略 `main()` 函数末尾的 `return` 语句。但是，不要在其他有返回值的函数中漏掉它。

## 语句

C 语言的代码由一行行语句（`statement`）组成。一行语句就是程序执行的一个操作命令。C 语言规定，语句必须使用分号结尾，除非有明确规定可以不写分号，分号表明语句结束符。例如：

```c
int num;
num = 1;
```

多个语句可以写在一行。例如：

```c
int num; num = 1;
```

一个语句也可以写成多行，这时就要依靠分号判断语句在哪一行结束。例如：

```c
int
num
;

num
=
1
;
```

## 表达式

C 语言的各种计算，主要通过表达式完成。表达式（`expression`）是一个计算式，用来获取值。例如：

```c
1 + 2
```

::: info 表达式与语句的区别
- 语句可以包含表达式，但是表达式不构成语句
- 表达式都有返回值，语句不一定有。因为语句用来执行某个命令，很多时候不需要返回值，比如：变量声明语句 `int i = 1;`
:::

## 空格

空格主要用来帮助编译器区分语法单位，只是为了增加代码的可读性。语法单位之间的多个空格，等同于单个空格。例如：

```c
num = 1;
// 等同于
num=1;
// 等同于
i =     1;
```
